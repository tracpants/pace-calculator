<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modal Tests - Pace Calculator</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f3f4f6;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .test-button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #4338ca;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .pass { background: #d1fae5; color: #065f46; }
        .fail { background: #fee2e2; color: #991b1b; }
        .info { background: #dbeafe; color: #1e40af; }
        
        /* Copy modal styles from main app */
        .modal-container {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 50;
            overflow-y: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            transition: opacity 0.3s ease, backdrop-filter 0.3s ease;
        }
        
        .modal-container.hidden {
            display: none;
        }
        
        .modal-content {
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            padding: 1.5rem;
            margin: 2rem 0;
            position: relative;
            display: flex;
            flex-direction: column;
            background-color: white;
            border: 1px solid #e5e7eb;
            max-height: calc(100vh - 4rem);
            overflow: hidden;
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            max-width: 28rem;
        }
        
        .modal-container:not(.hidden) .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }
        
        .modal-close:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Modal UI Tests - Pace Calculator</h1>
        
        <div class="test-section">
            <h2>Manual Modal Tests</h2>
            <p>Click each button to test modal behavior. Check for:</p>
            <ul>
                <li>Dark background scrim covers full viewport</li>
                <li>Blur effect is visible</li>
                <li>Modal content appears centered</li>
                <li>Modal can be closed by clicking backdrop or close button</li>
            </ul>
            
            <button class="test-button" onclick="openTestModal('help')">Test Help Modal</button>
            <button class="test-button" onclick="openTestModal('settings')">Test Settings Modal</button>
            <button class="test-button" onclick="openTestModal('pr-management')">Test PR Management Modal</button>
            <button class="test-button" onclick="runAutomatedTests()">Run Automated Tests</button>
        </div>
        
        <div class="test-section">
            <h2>Automated Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Current Modal Styles Debug</h2>
            <button class="test-button" onclick="debugModalStyles()">Debug Modal Styles</button>
            <div id="debug-results"></div>
        </div>
    </div>

    <!-- Test Modals -->
    <div id="test-help-modal" class="modal-container hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Help Modal Test</h2>
                <button class="modal-close" onclick="closeTestModal('help')">×</button>
            </div>
            <div>
                <p>This is a test help modal. The background should be dimmed with a dark overlay and blur effect.</p>
            </div>
        </div>
    </div>

    <div id="test-settings-modal" class="modal-container hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings Modal Test</h2>
                <button class="modal-close" onclick="closeTestModal('settings')">×</button>
            </div>
            <div>
                <p>This is a test settings modal. The background should be dimmed with a dark overlay and blur effect.</p>
            </div>
        </div>
    </div>

    <div id="test-pr-management-modal" class="modal-container hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>PR Management Modal Test</h2>
                <button class="modal-close" onclick="closeTestModal('pr-management')">×</button>
            </div>
            <div>
                <p>This is a test PR management modal. The background should be dimmed with a dark overlay and blur effect.</p>
            </div>
        </div>
    </div>

    <script>
        // Test modal functions
        function openTestModal(type) {
            const modal = document.getElementById(`test-${type}-modal`);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeTestModal(type) {
            const modal = document.getElementById(`test-${type}-modal`);
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Automated tests
        function runAutomatedTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '';
            
            const tests = [
                () => testModalVisibility(),
                () => testModalScrim(),
                () => testModalContent(),
                () => testModalClosing(),
            ];
            
            tests.forEach((test, index) => {
                try {
                    const result = test();
                    addTestResult(results, `Test ${index + 1}`, result.pass, result.message);
                } catch (error) {
                    addTestResult(results, `Test ${index + 1}`, false, `Error: ${error.message}`);
                }
            });
        }

        function testModalVisibility() {
            const modal = document.getElementById('test-help-modal');
            
            // Test hidden state
            const hiddenDisplay = window.getComputedStyle(modal).display;
            if (hiddenDisplay !== 'none') {
                return { pass: false, message: `Hidden modal should have display: none, got: ${hiddenDisplay}` };
            }
            
            // Test visible state
            modal.classList.remove('hidden');
            const visibleDisplay = window.getComputedStyle(modal).display;
            modal.classList.add('hidden'); // Reset
            
            if (visibleDisplay !== 'flex') {
                return { pass: false, message: `Visible modal should have display: flex, got: ${visibleDisplay}` };
            }
            
            return { pass: true, message: 'Modal visibility states work correctly' };
        }

        function testModalScrim() {
            const modal = document.getElementById('test-help-modal');
            const computedStyle = window.getComputedStyle(modal);
            
            const backgroundColor = computedStyle.backgroundColor;
            const backdropFilter = computedStyle.backdropFilter;
            
            // Check for dark background (should be rgba with alpha < 1)
            const hasScrim = backgroundColor.includes('rgba') && backgroundColor.includes('0.5');
            const hasBlur = backdropFilter.includes('blur');
            
            if (!hasScrim) {
                return { pass: false, message: `Modal should have dark scrim background, got: ${backgroundColor}` };
            }
            
            if (!hasBlur) {
                return { pass: false, message: `Modal should have backdrop blur, got: ${backdropFilter}` };
            }
            
            return { pass: true, message: 'Modal scrim and blur effects are correctly applied' };
        }

        function testModalContent() {
            const modal = document.getElementById('test-help-modal');
            const content = modal.querySelector('.modal-content');
            
            modal.classList.remove('hidden');
            const contentStyle = window.getComputedStyle(content);
            modal.classList.add('hidden'); // Reset
            
            const opacity = parseFloat(contentStyle.opacity);
            const transform = contentStyle.transform;
            
            if (opacity !== 1) {
                return { pass: false, message: `Modal content should be fully opaque when visible, got opacity: ${opacity}` };
            }
            
            if (transform.includes('scale(0.95)')) {
                return { pass: false, message: `Modal content should not be scaled down when visible, got transform: ${transform}` };
            }
            
            return { pass: true, message: 'Modal content displays correctly when visible' };
        }

        function testModalClosing() {
            const modal = document.getElementById('test-help-modal');
            
            // Open modal
            modal.classList.remove('hidden');
            
            // Test backdrop click
            const event = new MouseEvent('click', { bubbles: true });
            Object.defineProperty(event, 'target', { value: modal });
            
            // Simulate backdrop click handler
            if (event.target === modal) {
                modal.classList.add('hidden');
            }
            
            const isHidden = modal.classList.contains('hidden');
            
            if (!isHidden) {
                return { pass: false, message: 'Modal should close when backdrop is clicked' };
            }
            
            return { pass: true, message: 'Modal closing behavior works correctly' };
        }

        function addTestResult(container, testName, pass, message) {
            const div = document.createElement('div');
            div.className = `test-result ${pass ? 'pass' : 'fail'}`;
            div.textContent = `${testName}: ${pass ? 'PASS' : 'FAIL'} - ${message}`;
            container.appendChild(div);
        }

        function debugModalStyles() {
            const results = document.getElementById('debug-results');
            const modal = document.getElementById('test-help-modal');
            const computedStyle = window.getComputedStyle(modal);
            
            const debugInfo = {
                'Display (hidden)': computedStyle.display,
                'Position': computedStyle.position,
                'Z-Index': computedStyle.zIndex,
                'Background Color': computedStyle.backgroundColor,
                'Backdrop Filter': computedStyle.backdropFilter,
                'Top': computedStyle.top,
                'Left': computedStyle.left,
                'Width': computedStyle.width,
                'Height': computedStyle.height,
            };
            
            modal.classList.remove('hidden');
            const visibleStyle = window.getComputedStyle(modal);
            modal.classList.add('hidden');
            
            debugInfo['Display (visible)'] = visibleStyle.display;
            
            results.innerHTML = '<h3>Modal CSS Properties:</h3>';
            Object.entries(debugInfo).forEach(([prop, value]) => {
                const div = document.createElement('div');
                div.className = 'test-result info';
                div.textContent = `${prop}: ${value}`;
                results.appendChild(div);
            });
        }

        // Add backdrop click handlers
        document.querySelectorAll('.modal-container').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            });
        });
    </script>
</body>
</html>